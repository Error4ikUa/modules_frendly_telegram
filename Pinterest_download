from .. import loader, utils
import asyncio

class PintrMod(loader.Module):
    strings = {"name": "Pintr"}

    async def client_ready(self, client, db):
        self.client = client

    async def pintrcmd(self, message):
        args = utils.get_args_raw(message)
        if not args:
            await message.edit("❌ Вкажіть посилання.")
            return

        bot_entity = await self.client.get_entity("@TopSaverBot")

        # Отправляем ссылку боту
        await self.client.send_message(bot_entity, args)
        await message.edit("⏳ поки очікуємо відео хочу сказати що кохаю Віку, ладно вот відео...")

        # Ждем 5 секунд для обработки ботом
        await asyncio.sleep(5)

        # Проходим по последним сообщениям от бота
        async for response in self.client.iter_messages(bot_entity, limit=5):
            # Ищем только сообщения с медиа и без текста (чтобы исключить рекламу)
            if response.media and not response.message:
                await message.respond(file=response.media)
                return

        await message.edit("⚠️ Бот не надіслав медіа у відповідь або надіслав рекламні повідомлення.")
